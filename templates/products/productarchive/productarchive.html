{% extends "base.html" %}
{% load static %}
{% load wagtailcore_tags %}
{% block TITLE %}{{ page.title }}{% endblock %}
{% block HEADJS %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{% endblock %}
{% block CONTENT %}
{% if messages %}
{% for message in messages %}
    {% if message.tags == 'success' %}
        <script>alert('{{ message }}');</script>
    {% elif message.tags == 'error' %}
    <script>alert('{{ message }}');</script>
    {% endif %}
{% endfor %}
{% endif %}
<header class="headerblog">
      <div class="h1divhead">
        <h1 class="blogh1 white-color">آرشیو محصولات</h1>
      </div>
    </header>
    <main class="container-fluid">
      <div class="row">
        <div class="col-xxl-3 col-xl-3 col-lg-4 col-md-4 col-sm-12 col-12">
          <div class="position-sticky" style="top: 1rem">
            <div class="p-4 mb-3 asidefilter">
              <h4 class="h3 bchs">انتخاب دسته بندی</h4>
              <ul class="navliststyle asidecat">
                <li class="bbs1px">
                  <a href="" class="black-color ahover">دسته بندی یک</a>
                  <span>6</span>
                </li>
              </ul>
            </div>
            <div class="p-4 mb-3 asidefilter">
              <h4 class="h3 bchs">فیلتر محصول</h4>
              <label for="specialdiscount">بدون فیلتر</label>
              <input type="checkbox" id="specialdiscount" /><br />
              <label for="inventory">محصولات موجود </label>
              <input type="checkbox" id="inventory" /><br />
              <label for="specialdiscount">محصولات تخفیف دار</label>
              <input type="checkbox" id="specialdiscount" />
            </div>
            <div class="p-4 mb-3 asidefilter">
              <h4 class="h3 bchs">فیلتر قیمت</h4>
              <input
                type="number"
                id="min-price"
                placeholder="حداقل قیمت از.....تومان"
              />
              <input
                type="number"
                id="max-price"
                placeholder="حداکثر قیمت تا.....تومان"
              />
              <button
                class="btn btn-outline-danger"
                onclick="filterProducts() "
              >
                اعمال فیلتر
              </button>
            </div>
            <div class="p-4 mb-3 asidefilter">
              <h4 class="h3 bchs">فیلتر برند</h4>
              <button
                class="btn btn-outline-danger"
                onclick="//filterProducts() "
              >
                اعمال فیلتر
              </button>
            </div>
          </div>
        </div>
        <section class="col-xxl-9 col-xl-9 col-lg-8 col-md-8 col-sm-12 col-12">
          <div class="sortpro">
            <span class="bi bi-sort-down"> مرتب سازی: </span>
            <span class="icon2">پیشفرض</span>
            <span class="icon2">پرفروش‌ترین‌</span>
            <span class="icon2">ارزان‌ترین</span>
            <span class="icon2">گران‌ترین</span>
            <span class="icon2">جدیدترین</span>
          </div>

          <div id="PRODUCT" class="row">
            <!-- IMPORT CONTEXT FROM JS -->
          </div>
          <div class="plusbutton">
            <button type="button" class="btn btn-outline-danger" id="load-more">
              بارگیری بیشتر محصولات
            </button>
        </section>
      </div>
    </main>
{% block JS %}
<script>
$(document).ready(function() {
  var perPage = 8;
  var page = 1;

  function loadProducts() {
    var startIndex = (page - 1) * perPage;
    var endIndex = startIndex + perPage;

    $.getJSON(`/UNIQUEAPI174/pages/?type=product.InventoryItem`, function(data) {
      var product_item = data.items;
      if (product_item.length > 0) {
        totalPages = Math.ceil(product_item.length / perPage);

        for (var i = startIndex; i < endIndex; i++) {
          if (i >= product_item.length) {
            break;
          }
          var productPage = product_item[i];
          var productPageId = productPage.id;
          var productPageSlug = productPage.meta.slug;
          var productPostsAPIURL = `/UNIQUEAPI174/pages/${productPageId}`;
          $.getJSON(productPostsAPIURL, function(productsData) {
            var product = productsData;
            if (product.PRODUCT_OFFER.length > 0) {
              var postHTML = `
                <div id="PRODUCT_BODY" class="cardpro" style="width: 18rem">
                  <img src="${product.image.url}" class="card-img-top" alt="${product.image.alt}" />
                  <div class="card-body">
                    <h3 class="card-title h4">
                      <a href="" class="black-color">${product.title}</a>
                    </h3>
                    <span class="text-decoration-line-through icon2">${product.price}</span>
                    <span class="red-color">${product.PRODUCT_OFFER[0].value}<span>تومان</span></span>
                    <hr />
                    <div id="TOOLS" class="tolspro">
                      <span class="bi bi-heart"></span>
                      <span class="price"></span>
                      <a href="${product.meta.html_url}"><button class="btn btn-danger addtocard" type="submit">مشاهده و خرید</button></a>
                      <span class="bi bi-arrow-left-right"></span>
                    </div>
                  </div>
                </div>
              `;
              $('#PRODUCT').append(postHTML);
            } else {
              var postHTML = `
                <div id="PRODUCT_BODY" class="cardpro" style="width: 18rem">
                  <img src="${product.image.url}" class="card-img-top" alt="${product.image.alt}" />
                  <div class="card-body">
                    <h3 class="card-title h4">
                      <a href="" class="black-color">${product.title}</a>
                    </h3>
                    <span class="red-color">${product.price}<span>تومان</span></span>
                    <hr />
                    <div id="TOOLS" class="tolspro">
                      <span class="bi bi-heart"></span>
                      <span class="price"></span>
                      <a href="${product.meta.html_url}"><button class="btn btn-danger addtocard" type="submit">مشاهده و خرید</button></a>
                      <span class="bi bi-arrow-left-right"></span>
                    </div>
                  </div>
                </div>
              `;
              $('#PRODUCT').append(postHTML);
            }

          });
        }
        if (page >= totalPages) {
          $('#load-more').hide();
        } else {
          $('#load-more').show();
        }

        page++;
      }
    });
  }

  loadProducts();
});
</script>
<script
src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"
integrity="sha384-zYPOMqeu1DAVkHiLqWBUTcbYfZ8osu1Nd6Z89ify25QV9guujx43ITvfi12/QExE"
crossorigin="anonymous"
></script>
<script
src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.min.js"
integrity="sha384-Y4oOpwW3duJdCWv5ly8SCFYWqFDsfob/3GkgExXKV4idmbt98QcxXYs9UoXAB7BZ"
crossorigin="anonymous"
></script>
<script src="{% static 'js/main.js' %}"></script>
{% endblock %}
{% endblock %}
